{%- comment -%}
Inputs:
- block.settings.tag_map: CSV like "sale:Sale,new:New,bestseller:Bestseller"
- block.settings.use_metafields: boolean
- product.metafields.badges.flags: list (single_line_text_field[])

Output: <ul> of badges, limited by max_badges
{%- endcomment -%}

{%- assign labels_csv = '' -%}

{%- assign tag_map = block.settings.tag_map | default: '' | split: ',' -%}
{%- for pair in tag_map -%}
  {%- assign kv = pair | split: ':' -%}
  {%- assign key = kv[0] | strip -%}
  {%- assign val = kv[1] | default: '' | strip -%}
  {%- if key != blank and val != blank and product.tags contains key -%}
    {%- assign labels_csv = labels_csv | append: val | append: '|' -%}
  {%- endif -%}
{%- endfor -%}

{%- assign labels = labels_csv | split: '|' | compact -%}

{%- if block.settings.use_metafields and product.metafields.badges.flags.value != blank -%}
  {%- assign labels = labels | concat: product.metafields.badges.flags.value -%}
{%- endif -%}

{%- assign labels = labels | uniq -%}

{%- if labels.size > 0 -%}
  <div class="prd-badges" aria-label="Badges">
    <ul class="prd-badges__list">
      {%- for label in labels limit: block.settings.max_badges -%}
        <li class="prd-badge">{{ label }}</li>
      {%- endfor -%}
    </ul>
  </div>
{%- endif -%}
